---
title: "BIO 465 Analysis Exercise 2"
author: "Artem Golotin"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction

The goal of this assignment is to help you gain more experience with R. After completing the steps outlined below, please submit the resulting HTML file via Learning Suite. You will be graded on whether you completed all of the analysis steps correctly. If you are unsure on any of the steps, please stop by my office and/or send me an email message.

## Setting your working directory

For part of this exercise, you will be asked to read and write files. When you tell R where to find (or save) a file, you can provide one of two types of file path: absolute or relative. When you specify an _absolute_ path, you indicate where on the file system the file is located in relation to the _root_ directory (<https://en.wikipedia.org/wiki/Root_directory>). When you specify a _relative_ path, you indicate where on the file system the file is located in relation to the _current_ directory. The advantage of using an absolute path is that R will be able to find the file, no matter which directory R is executed in. The advantage of using a relative path is that it is more succinct.

If you want, you can tell R to always look for files in the same directory. This is called your "working directory." You can change your working directory using a command such as the following.

```{r}
# setwd("~/Dropbox/Teaching/BIO465/Analysis_Exercises")
```

Write a command to set your working directory to the directory where you have saved this Markdown file.

```{r}
setwd("~/Desktop/BIO465")
```

## Loading and viewing data

For this exercise, you will analyze a data file that has been provided by GapMinder (<http://www.gapminder.org>). This file is called "gapminder-FiveYearData.csv" and was included with this assignment.

This comma-delimited file indicates life expectancy and GDP per capita for 142 countries over the past few decades. To analyze the data, you will need to load it into R. R provides various functions that make it possible to read data files. For example, to read a CSV file, you can use the ```read.csv``` function. (Or you could use ```read.table``` for a tab-delimited file.)

The following code uses the ```read.csv``` function to read the "gapminder-FiveYearData.csv file into an object called ```data```.

```{r}
data <- read.csv("gapminder-FiveYearData.csv")
```

This should be a "data frame" object. You can think of this as being similar in concept to an Excel spreadsheet, which contains rows and columns in a grid format. Write command(s) that indicate how many rows and columns this object has. (Refer to the previous assignment, if needed.)

```{r}
print(dim(data))
```

The ```str``` function provides a brief summary of the "**str**ucture" of the data contained within that object. Please apply this function to the ```data``` object.

```{r}
print(str(data))
```

When you have a data frame that contains a large number of rows, you may want to just look at the first few rows to get a better feel for the data. You can use the ```head``` command for this. Write a command that uses the ```head``` function to display the first 20 rows of the data. You will need to specify a value for the ```n``` parameter when calling this function. (Look at the help documentation if needed.)

```{r}
print(head(data, n = 20))
```

The ```head``` function can be applied to almost any object type in R, including matrices and vectors. There is also a ```tail``` command that enables you to look at the last few rows of a data frame.

## Working with vectors

You can use the ```rownames``` and ```colnames``` functions to retrieve (or set) the row names and column names, respectively, from a data frame. Use the ```colnames``` function to retrieve the column names for the ```data``` object and assign them to a variable.

```{r}
colnames_data <- colnames(data)
```

Write a command that will display the object type for the variable you just created.

```{r}
print(class(colnames_data))
```

When it says the object type is "character," that means that it is a one-dimensional vector of values that are all character (string) values.

Write a command that indicates the number of values in this vector. (Hint: use the ```length``` command.)

```{r}
print(length(colnames_data))
```

Use the ```head``` function to print the first 3 items in this vector.

```{r}
print(head(colnames_data, n = 3))
```

When working with a data frame, there is a shortcut that can be used to obtain all the values in a specific column. You use the ```$``` sign for this. For example, if you wanted to obtain all the values in the "country" column, you would enter the following command.

```{r}
countryVals <- data$country

print(head(countryVals))
```

Extract the "lifeExp" column values into a variable called ```lifeExpVals``` and print the object type of this variable.

```{r}
lifeExpVals <- data$lifeExp
print(class(lifeExpVals))
```

The class of this object should be ```numeric```, meaning that it is a vector of numerical values.

### Using the ```sapply``` function

Another way to work with vector objects is to use the ```sapply``` function, which enables you to apply a function to each value in a vector. This could be an existing function or an anonymous function. For example, if you wanted to apply the ```sqrt``` function to each value in a vector, you could do something like the following.

```{r}
x <- sapply(lifeExpVals, sqrt)

print(head(x))
```

Or if you wanted to do this with an anonymous function, you would do the following.

```{r}
x <- sapply(lifeExpVals, function(x) { sqrt(x) })

print(head(x))
```

Please note that the previous two examples were for demonstration purposes only. If you wanted to apply the ```sqrt``` function to a vector of numeric values, a simpler way is shown below. However, in more advanced cases, the ```sapply``` function does come in handy. 

```{r}
x <- sqrt(lifeExpVals)
```

Practice using the ```sapply``` function by writing a command that uses an anonymous function to add 5 years to the average life expectancy for each value in the ```lifeExpVals``` object.

```{r}
sapply(lifeExpVals, function(x) {x + 5})
```

## Working with ```factor``` objects

Now print the class of the ```countryVals``` object that was created above.

```{r}
print(countryVals)
```

This is a ```factor``` object. A factor object is used to represent "discrete" data. Discrete values can contain only a finite number of values. (This is in contrast to numeric or character vectors, which can contain any numeric value or character string, respectively.) In the case of the ```countryVals`` object, it makes sense that it would be a ```factor``` object because there are only a finite number of countries (142 in this data set).

Each possible value in a factor is called a ```level```. One way to summarize a ```factor``` object is to use the ```table``` function. It indicates how many values are present for each level. Apply the ```table``` function to the ```countryVals``` object.

```{r}
table(countryVals)
```

This should have indicated that there are 12 values for each country.

You can apply many R functions to the output of ```table```. For example, if you wanted to know the maximum number of data values that were present for any country, you could use the following command.

```{r}
max(table(countryVals))
```

## Subsetting data frames

Now suppose you wanted to obtain all the rows in the ```data``` object that represented Afghanistan. You could use the ```which``` function for this. If you apply the ```which``` function to the "country" column, it will tell you the index of each row that is "Afghanistan." For example:

```{r}
afghIndices <- which(data$country=="Afghanistan")

print(afghIndices)
```

You could then obtain these rows from the ```data``` object using the following command:

```{r}
afghData <- data[afghIndices,]

print(afghData)
```

Now create an object that contains data for the United States only. Call this object ```usData```.

```{r}
usData <- data[which(data$country=="United States"),]
```

## Merging data frames

When you have two data frame objects, you can merge them easily in R. For example, if you wanted to combine the Afghanistan data with the United States data, you could use the ```rbind``` function.

```{r}
rbind(afghData, usData)
```

There is also a ```cbind``` that you can used to "bind" two data frames by column (horizontally) rather than by row (vertically). For example:

```{r}
cbind(afghData, usData)
```

There are more advanced ways to do these types of operations, but we'll wait until a later exercise to go through these.

## Working with ```matrix``` objects

A data frame is similar in shape (2-dimensional) to a matrix. A key difference between these two object types is that a matrix can contain only one type of object (typically numeric values). If you tried to put two types of object into the same matrix, it would convert all the values to the more generic object type. For example, if you put character/string and integer objects in a matrix, it would convert all the values to character/string values, as demonstrated below.

```{r}
head(as.matrix(data))
```

Notice that each of the values is surrounded by quotation marks, which indicate these these are character values.

Let's create a matrix object that contains only the 5th and 6th columns of the data frame. These two columns contain only numerical data. With either a matrix or a data frame, we can extract specific columns (or rows) by specifying their indices rather than their names. The following code extracts the first 48 rows and the 5th and 6th columns.

```{r}
matrixData <- data[1:48,5:6]

print(head(matrixData))
```

Notice that all the values are numeric (none of them is surrounded by quotation marks).

Let's create a new variable that contains the country name for the first 48 rows.

```{r}
# Extract the first 48 values
countryValuesFirst48 <- countryVals[1:48]

print(countryValuesFirst48)
```

Notice that when we print this object, it contains the country name for the first 48 rows. However, because it is a factor object, it contains "levels" for all 142 countries that were listed in the full data set. So let's convert it to a character vector so it will "forget" the levels.

```{r}
countryValuesFirst48 <- as.character(countryValuesFirst48)

print(countryValuesFirst48)
```

Now we can convert it back to a factor object. This object will only contain 4 levels.

```{r}
countryValsFirst48 <- as.factor(countryValuesFirst48)

print(countryValsFirst48)
```

## Creating box and whisker plots

One way we can use the ```countryValsFirst48``` factor object is to create a "box and whisker" plot of the data. For example, we can see how life expectancy varies by country. To do this, we will use the ```boxplot``` function and specify a formula. Formulas in R typically use the ```~``` character to indicate the relationship between two variables. Below is an example. (Click on the "Zoom" button in RStudio if needed to see the full figure.)

```{r}
boxplot(matrixData$lifeExp ~ countryValsFirst48)
```

Which of these four countries has the highest average life expectancy?

#### Albania

Now create a boxplot that shows the relationship between country and GDP per capita for these four countries.

```{r}
boxplot(matrixData$gdpPercap ~ countryValsFirst48)
```

Which of these four countries has the highest GDP per capita?

#### Algeria

## Working with the ```apply``` function

When working with 2-dimensional objects (such as matrices and data frames), you can use the ```apply``` function to apply a function either to 1) all the rows of the object or 2) to all of the columns. For example, the following code would calculate the median value for both columns in the ```matrixData``` object.

```{r}
columnMedians <- apply(matrixData, 2, median)

print(columnMedians)
```

The second parameter in the ```apply``` function is a value of ```2```. This is because R uses ```1``` to represent rows and ```2``` to represent columns. If we wanted to apply the median function to each row, we would do the following.

```{r}
rowMedians <- apply(matrixData, 1, median)
```

After completing the steps requested above, knit this document and submit the resulting HTML file via Learning Suite.